#!/usr/bin/env python
import rospy
import os
import cantools
from can_msgs.msg import Frame
from mobileye_msgs.msg import Mobileye
from mobileye_msgs.msg import ObstacleInfo

class can_parser:

    def __init__(self):

        script_dir = os.path.dirname(__file__)
        can_db_path = os.path.join(script_dir, '../DBC/CAN2_TRW.dbc')
        self.db = cantools.database.load_file(can_db_path)

        rospy.Subscriber("/can/mobileye/rx", Frame, self.rx_callback)
        self.rx_pub = rospy.Publisher("/mobileye", Mobileye, queue_size=1)

        self.cdata = Mobileye()
        self.cdata.max_obstacles = 10
        self.cdata.obstacle = [ObstacleInfo()]*10

    def rx_callback(self, data):
        try:
            signals = self.db.decode_message(data.id, data.data)
            # rospy.loginfo(data.id)
        except KeyError:
            return

